<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Turbojet Engine Simulation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0;
    }
    .container {
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    canvas {
      border: 1px solid #333;
      background-color: #000;
      margin: 20px 0;
      width: 100%;
      max-width: 800px;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .control-group label {
      margin-bottom: 5px;
    }
    button {
      padding: 8px 16px;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #0055aa;
    }
    .legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .legend-color {
      width: 20px;
      height: 20px;
      border: 1px solid #333;
    }
    .data-display {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .data-item {
      font-weight: bold;
      margin: 5px 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Turbojet Engine Simulation</h1>
    <p>Adjust parameters to see how they affect the turbojet's operation.</p>

    <!-- Controls -->
    <div class="controls">
      <!-- Inlet control -->
      <div class="control-group">
        <label for="inlet">Inlet Angle: <span id="inlet-value">1</span></label>
        <input type="range" id="inlet" min="0" max="2" step="1" value="1">
      </div>

      <!-- Compressor control -->
      <div class="control-group">
        <label for="compressor">Compressor Speed: <span id="compressor-value">5</span></label>
        <input type="range" id="compressor" min="1" max="10" step="1" value="5">
      </div>

      <!-- Fuel control -->
      <div class="control-group">
        <label for="fuel">Fuel Flow: <span id="fuel-value">1</span></label>
        <input type="range" id="fuel" min="0" max="2" step="1" value="1">
      </div>

      <!-- Turbine control -->
      <div class="control-group">
        <label for="turbine">Turbine Efficiency: <span id="turbine-value">1</span></label>
        <input type="range" id="turbine" min="0" max="2" step="1" value="1">
      </div>

      <!-- Nozzle control -->
      <div class="control-group">
        <label for="nozzle">Nozzle Area: <span id="nozzle-value">1</span></label>
        <input type="range" id="nozzle" min="0" max="2" step="1" value="1">
      </div>
    </div>

    <!-- Toggle button -->
    <button id="toggle">Pause/Resume</button>

    <!-- Canvas -->
    <canvas id="turbojetCanvas" width="800" height="300"></canvas>

    <!-- Data Display -->
    <div class="data-display">
      <div class="data-item">Intake Pressure: <span id="intakePressure">N/A</span></div>
      <div class="data-item">Compressor Ratio: <span id="compRatio">N/A</span></div>
      <div class="data-item">Combustion Temp: <span id="combustionTemp">N/A</span></div>
      <div class="data-item">Turbine Power: <span id="turbinePower">N/A</span></div>
      <div class="data-item">Thrust: <span id="thrust">N/A</span></div>
      <div class="data-item">Efficiency: <span id="efficiency">N/A</span></div>
    </div>

    <!-- Legend -->
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background-color: #3366ff;"></div>
        <span>Intake Air</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #ff6600;"></div>
        <span>Combustion</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #ff3333;"></div>
        <span>High Pressure</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #ffcc00;"></div>
        <span>Exhaust</span>
      </div>
    </div>

    <!-- Explanation -->
    <div>
      <h3>How a Turbojet Works:</h3>
      <p>
        A turbojet engine draws in air through the intake, compresses it with multiple compressor stages, 
        mixes the compressed air with fuel in the combustion chamber, and ignites the mixture. The hot, 
        high-pressure gas expands through turbine stages (which drive the compressor) and finally exits 
        through the nozzle, producing thrust. Adjust the sliders to see how changing the inlet angle, 
        compressor speed, fuel flow, turbine efficiency, and nozzle area affects performance.
      </p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('turbojetCanvas');
      const ctx = canvas.getContext('2d');

      // Sliders
      const inletSlider = document.getElementById('inlet');
      const compressorSlider = document.getElementById('compressor');
      const fuelSlider = document.getElementById('fuel');
      const turbineSlider = document.getElementById('turbine');
      const nozzleSlider = document.getElementById('nozzle');

      // Slider value display elements
      const inletValue = document.getElementById('inlet-value');
      const compressorValue = document.getElementById('compressor-value');
      const fuelValue = document.getElementById('fuel-value');
      const turbineValue = document.getElementById('turbine-value');
      const nozzleValue = document.getElementById('nozzle-value');

      // Data display
      const intakePressureDisplay = document.getElementById('intakePressure');
      const compRatioDisplay = document.getElementById('compRatio');
      const combustionTempDisplay = document.getElementById('combustionTemp');
      const turbinePowerDisplay = document.getElementById('turbinePower');
      const thrustDisplay = document.getElementById('thrust');
      const efficiencyDisplay = document.getElementById('efficiency');

      // Toggle button
      const toggleButton = document.getElementById('toggle');

      // Simulation state
      let running = true;
      let particles = [];
      const maxParticles = 150;

      // Engine geometry
      const engineX = 50;
      const engineY = 50;
      const engineLength = 700;
      const engineHeight = 120;

      // Create initial particles
      createParticles();

      // Start animation
      let animationId;
      animate();

      // ======== Functions ========

      function animate() {
        if (running) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawEngine();
          updateParticles();
          updateMetrics();
        }
        animationId = requestAnimationFrame(animate);
      }

      // Draw engine outline and labeled sections
      function drawEngine() {
        const inletSetting = parseInt(inletSlider.value);
        const nozzleSetting = parseInt(nozzleSlider.value);

        // Calculate intake shape
        const inletTopShift = inletSetting * 10;
        const inletBottomShift = inletSetting * 10;

        // Nozzle shape
        const nozzleTopShift = nozzleSetting * 10;
        const nozzleBottomShift = nozzleSetting * 10;

        ctx.strokeStyle = '#ccc';
        ctx.lineWidth = 2;
        ctx.beginPath();

        // Top line
        ctx.moveTo(engineX, engineY + inletTopShift);
        ctx.lineTo(engineX + 150, engineY); // front compressor area
        ctx.lineTo(engineX + 350, engineY); // end of compressor area
        ctx.lineTo(engineX + 450, engineY + 10); // combustion chamber top
        ctx.lineTo(engineX + 550, engineY + nozzleTopShift); // turbine to nozzle
        ctx.lineTo(engineX + engineLength, engineY + nozzleTopShift);

        // Bottom line
        ctx.lineTo(engineX + engineLength, engineY + engineHeight + nozzleBottomShift);
        ctx.lineTo(engineX + 550, engineY + engineHeight + nozzleBottomShift - 10);
        ctx.lineTo(engineX + 450, engineY + engineHeight - 10);
        ctx.lineTo(engineX + 350, engineY + engineHeight);
        ctx.lineTo(engineX + 150, engineY + engineHeight);
        ctx.lineTo(engineX, engineY + engineHeight + inletBottomShift);

        ctx.closePath();
        ctx.stroke();

        // Section markers
        // 1) Intake
        labelSection("Intake", engineX + 60, engineY + engineHeight / 2);
        // 2) Low/High Compressor
        labelSection("Compressors", engineX + 250, engineY + engineHeight / 2);
        // 3) Combustion Chamber
        labelSection("Combustion\nChamber", engineX + 450, engineY + engineHeight / 2);
        // 4) Turbine
        labelSection("Turbine", engineX + 550, engineY + engineHeight / 2);
        // 5) Exhaust Nozzle
        labelSection("Nozzle", engineX + 650, engineY + engineHeight / 2);
      }

      // Helper to label sections
      function labelSection(text, x, y) {
        ctx.fillStyle = '#ccc';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        const lines = text.split('\n');
        lines.forEach((line, index) => {
          ctx.fillText(line, x, y + index * 16 - (lines.length - 1) * 8);
        });
      }

      // Create air particles
      function createParticles() {
        particles = [];
        for (let i = 0; i < maxParticles; i++) {
          addParticle();
        }
      }

      // Add a single particle
      function addParticle() {
        const yPos = engineY + 10 + Math.random() * (engineHeight - 20);
        particles.push({
          x: -20 - Math.random() * 100,
          y: yPos,
          speed: 2 + Math.random() * 2,
          size: 2 + Math.random() * 2,
          color: '#3366ff', // intake color
          state: 'intake'
        });
      }

      // Update particles
      function updateParticles() {
        const compressorSpeed = parseInt(compressorSlider.value);
        const fuelFlow = parseInt(fuelSlider.value);
        const turbineEff = parseInt(turbineSlider.value);
        const nozzleArea = parseInt(nozzleSlider.value);

        for (let i = 0; i < particles.length; i++) {
          const p = particles[i];

          // Move particle
          p.x += p.speed;

          // States based on x-position
          const compressorStart = engineX + 150;
          const compressorEnd = engineX + 350;
          const combustionStart = engineX + 350;
          const combustionEnd = engineX + 450;
          const turbineStart = engineX + 450;
          const turbineEnd = engineX + 550;
          const nozzleStart = engineX + 550;
          const nozzleEnd = engineX + engineLength;

          if (p.x >= compressorStart && p.x < compressorEnd) {
            // Compressors
            p.state = 'compressor';
            p.color = '#ff3333'; // high pressure color
            // Speed and size changes with compressor speed
            p.speed = 2 + compressorSpeed * 0.5;
            p.size = 2 + compressorSpeed * 0.1;
          } 
          else if (p.x >= combustionStart && p.x < combustionEnd) {
            // Combustion
            p.state = 'combustion';
            p.color = getCombustionColor(fuelFlow);
            // Particles expand slightly in combustion
            p.speed = 2 + compressorSpeed * 0.3 + fuelFlow * 0.3;
            p.size = 3 + fuelFlow * 0.5;
          }
          else if (p.x >= turbineStart && p.x < turbineEnd) {
            // Turbine
            p.state = 'turbine';
            p.color = '#ff6600';
            // Speed influenced by turbine efficiency
            p.speed = 2 + compressorSpeed * 0.3 + fuelFlow * 0.2 + turbineEff * 0.5;
            p.size = 2 + turbineEff * 0.3;
          }
          else if (p.x >= nozzleStart && p.x < nozzleEnd) {
            // Nozzle
            p.state = 'nozzle';
            p.color = '#ffcc00';
            // Speed influenced by nozzle area (smaller area -> higher velocity)
            if (nozzleArea === 0) {
              // Large nozzle -> moderate speed
              p.speed = 3 + turbineEff * 0.5;
            } else if (nozzleArea === 1) {
              // Medium nozzle -> higher speed
              p.speed = 4 + turbineEff * 0.6;
            } else {
              // Small nozzle -> highest speed
              p.speed = 5 + turbineEff * 0.7;
            }
          } 
          else if (p.x < compressorStart) {
            // Intake region
            p.state = 'intake';
            p.color = '#3366ff';
            p.speed = 2 + Math.random() * 2;
          }

          // Draw the particle
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fillStyle = p.color;
          ctx.fill();

          // If particle goes beyond the engine, recycle it
          if (p.x > canvas.width + 50) {
            particles.splice(i, 1);
            addParticle();
            i--;
          }
        }
      }

      // Returns a color based on the fuel flow
      function getCombustionColor(fuelFlow) {
        // Increase red intensity with fuel flow
        const red = 200 + fuelFlow * 55;   // up to 255
        const green = 100 - fuelFlow * 50; // goes down
        const blue = 0;
        return `rgb(${red},${Math.max(green,0)},${blue})`;
      }

      // Update the metrics display
      function updateMetrics() {
        // Retrieve slider values
        const inletVal = parseInt(inletSlider.value);
        const compVal = parseInt(compressorSlider.value);
        const fuelVal = parseInt(fuelSlider.value);
        const turbineVal = parseInt(turbineSlider.value);
        const nozzleVal = parseInt(nozzleSlider.value);

        // Show slider values
        inletValue.textContent = inletVal;
        compressorValue.textContent = compVal;
        fuelValue.textContent = fuelVal;
        turbineValue.textContent = turbineVal;
        nozzleValue.textContent = nozzleVal;

        // Intake pressure (just a rough scale)
        const intakePressure = 1 + inletVal * 0.5;
        intakePressureDisplay.textContent = intakePressure.toFixed(2) + " atm";

        // Compressor ratio
        const compRatio = 5 + compVal * 2;
        compRatioDisplay.textContent = compRatio.toFixed(1) + ":1";

        // Combustion temperature (arbitrary scale)
        const combustionTemp = 800 + fuelVal * 300 + compVal * 20;
        combustionTempDisplay.textContent = combustionTemp.toFixed(0) + " K";

        // Turbine power
        const turbinePower = turbineVal * 50 + compVal * 10;
        turbinePowerDisplay.textContent = turbinePower.toFixed(0) + " kW";

        // Thrust calculation
        // Rough formula combining all factors
        const thrust = (compVal * 10) + (fuelVal * 15) + (turbineVal * 5) + (2 - nozzleVal) * 10;
        thrustDisplay.textContent = thrust.toFixed(1) + " kN";

        // Efficiency (very rough scale)
        // A higher compressor, moderate fuel, good turbine, and medium nozzle is typically best
        let effScore = 0;
        // InletVal 1 is ideal
        if (inletVal === 1) effScore += 1; 
        // Medium compressor speed (5) is somewhat standard
        if (compVal >= 4 && compVal <= 6) effScore += 1; 
        // FuelFlow 1 is moderate
        if (fuelVal === 1) effScore += 1; 
        // Turbine 2 is high efficiency
        if (turbineVal === 2) effScore += 1; 
        // Nozzle 1 is a good balance
        if (nozzleVal === 1) effScore += 1;

        let efficiency;
        if (effScore <= 1) efficiency = "Poor";
        else if (effScore === 2) efficiency = "Fair";
        else if (effScore === 3) efficiency = "Good";
        else if (effScore === 4) efficiency = "Very Good";
        else efficiency = "Excellent";
        efficiencyDisplay.textContent = efficiency;
      }

      // Toggle simulation
      toggleButton.addEventListener('click', () => {
        running = !running;
      });
    });
  </script>
</body>
</html>